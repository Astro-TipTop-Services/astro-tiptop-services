"use strict";(self.webpackChunktiptop_site=self.webpackChunktiptop_site||[]).push([[8978],{962:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/PathStaticOn-a10e26109b5bb4428a7e27a51d0ce441.jpg"},964:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/extra_errora-688b0922a731d893a4e0f6e0e34993c4.jpg"},2092:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/jitter_fwhm_0-6dcf87d7c68bb2308b9144bd453ebbce.jpg"},2595:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/extra_errorb-af85ca69882f94dd534a665434975e2e.jpg"},5337:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"orion/useful_scripts","title":"Tutorials Useful & Scripts","description":"This section provides a collection of useful scripts and detailed tutorials designed to help you","source":"@site/docs/orion/useful_scripts.mdx","sourceDirName":"orion","slug":"/orion/useful_scripts","permalink":"/astro-tiptop-services/docs/orion/useful_scripts","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"useful_scripts","title":"Tutorials Useful & Scripts","sidebar_label":"Tutorials & Useful Scripts","wip":true},"sidebar":"tipTopSidebar","previous":{"title":"Interactive tools \u2013 Generate Input Files & Convert Parameters","permalink":"/astro-tiptop-services/docs/orion/interactivetools"},"next":{"title":"Parameter files explained","permalink":"/astro-tiptop-services/docs/orion/parameterfiles"}}');var n=t(4848),s=t(8453),a=t(9030);t(6540);const o={id:"useful_scripts",title:"Tutorials Useful & Scripts",sidebar_label:"Tutorials & Useful Scripts",wip:!0},l=void 0,d={},c=[{value:"\ud83d\udcdd Tutorials",id:"-tutorials",level:2},{value:"\ud83d\udd35 Understanding Additional Error Terms in TipTop (Jitter, Extra Error and Static aberrations)",id:"-understanding-additional-error-terms-in-tiptop-jitter-extra-error-and-static-aberrations",level:3},{value:"Overview of the main parameters",id:"overview-of-the-main-parameters",level:3},{value:"1. Jitter (<code>jitter_FWHM</code>)",id:"1-jitter-jitter_fwhm",level:3},{value:"2. Extra high-order error (<code>extraErrorNm</code>, <code>extraErrorExp</code>, <code>extraErrorMin</code>, <code>extraErrorMax</code>)",id:"2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax",level:3},{value:"3. Static aberrations (<code>PathStaticOn</code>, <code>zCoefStaticOn</code>)",id:"3-static-aberrations-pathstaticon-zcoefstaticon",level:3},{value:"\ud83d\udcc4 Useful Scripts",id:"-useful-scripts",level:2},{value:"\ud83d\udd35 Run <i>N</i> <strong>TipTop</strong> Simulations with Different Parameter Values",id:"-run-n-tiptop-simulations-with-different-parameter-values",level:3},{value:"\ud83d\udd35 Rename Output FITS Files and Keep Backups",id:"-rename-output-fits-files-and-keep-backups",level:3},{value:"\ud83d\udd35 Sum rotated PSF",id:"-sum-rotated-psf",level:3}];function h(e){const r={a:"a",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components},{Details:i}=r;return i||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["This section provides a collection of useful scripts and detailed tutorials designed to help you\r\nrun, extend, and better understand ",(0,n.jsx)("b",{children:"TipTop"})," simulations for your own applications."]})}),"\n",(0,n.jsx)(r.h2,{id:"-tutorials",children:"\ud83d\udcdd Tutorials"}),"\n","\n",(0,n.jsx)(r.h3,{id:"-understanding-additional-error-terms-in-tiptop-jitter-extra-error-and-static-aberrations",children:"\ud83d\udd35 Understanding Additional Error Terms in TipTop (Jitter, Extra Error and Static aberrations)"}),"\n",(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:["This tutorial introduces the optional parameters that can be activated in ",(0,n.jsx)("b",{children:"TipTop"}),"\r\nto enrich simulated PSFs with additional, user-defined error contributions.",(0,n.jsx)(r.br,{}),"\n","These parameters allow you to represent effects that are not otherwise considered by ",(0,n.jsx)(r.strong,{children:"TipTop"}),", such as\r\nnon common path aberrations (NCPA), manufacturing tolerances, phasing errors in pupil segmented systems, or residual vibrations, ..."]}),(0,n.jsxs)(r.p,{children:["These configurable parameters can help you to produce more realistic PSFs, test \u201cwhat-if\u201d error budgets, or reproduce measured PSFs for specific analyses. ",(0,n.jsx)("br",{}),"\r\nPart of the purpose of this tutorial is therefore to illustrate which regions of the PSF\r\n(core width, halo level, etc.) are most sensitive to each additional error term.",(0,n.jsx)(r.br,{}),"\n","However, several effects can overlap, and the impact of individual parameters is sometimes\r\ndifficult to distinguish by eye. As a result, manual tuning often requires iterating and\r\nrevisiting parameters more than once. Because some error terms may compensate or mask each other, caution is recommended.\r\nBefore introducing new aberrations, users should refer to the page\r\n",(0,n.jsxs)("i",{children:["\u201c",(0,n.jsx)(r.a,{href:"/docs/general/error_breakdown",children:"What is included in TipTop?"}),"\u201d"]})," to avoid adding errors that are already taken into account."]})]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.h3,{id:"overview-of-the-main-parameters",children:"Overview of the main parameters"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(r.th,{style:{textAlign:"left"},children:"Required?"}),(0,n.jsx)(r.th,{style:{textAlign:"center"},children:"Type"}),(0,n.jsx)(r.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"jitter_FWHM"})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"float"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"None"}),", Additional kernel to be convolved with PSF, it could be a scalar (FWHM in ",(0,n.jsx)(r.strong,{children:"mas"}),") for a round kernel or a list of three values ",(0,n.jsx)(r.code,{children:"[FWHM_mas_max, FWHM_mas_min, angle_rad]"}),"."]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"extraErrorNm "})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"float"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"0"}),", ",(0,n.jsx)(r.strong,{children:"nm RMS"})," of the additional wavefront error to be added (an error that is not otherwise considered)."]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"extraErrorExp"})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"float"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"-2"}),", Exponent of the power of spatial frequencies used to generate the PSD associated with ",(0,n.jsx)(r.code,{children:"extraErrorNm"}),"."]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"extraErrorMin"})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"float"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"0"}),", Minimum spatial frequency ",(0,n.jsxs)("code",{children:["[m",(0,n.jsx)("sup",{children:"\u22121"}),"]"]})," for which PSD associated with ",(0,n.jsx)(r.code,{children:"extraErrorNm"})," is ",(0,n.jsx)(r.code,{children:"> 0"}),"."]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"extraErrorMax"})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"float"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"0"}),", Maximum spatial frequency ",(0,n.jsxs)("code",{children:["[m",(0,n.jsx)("sup",{children:"\u22121"}),"]"]})," for which PSD associated with ",(0,n.jsx)(r.code,{children:"extraErrorNm"})," is ",(0,n.jsx)(r.code,{children:"> 0"}),". ",(0,n.jsx)("br",{})," ",(0,n.jsx)(r.em,{children:"Note"}),": ",(0,n.jsx)(r.code,{children:"0"})," means maximum frequency is the one present in the spatial frequency array of the PSDs."]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"PathStaticOn"})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"string"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"None"}),", Path to a map of static aberrations (",(0,n.jsx)(r.strong,{children:"nm"}),") in .fits file. If absent or ",(0,n.jsx)(r.code,{children:"\u2018\u2019"}),", not used."]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"zCoefStaticOn"})}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"No"}),(0,n.jsx)(r.td,{style:{textAlign:"center"},children:(0,n.jsx)(r.code,{children:"list"})}),(0,n.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,n.jsx)(r.em,{children:"Default:"})," ",(0,n.jsx)(r.code,{children:"None"}),", Vector with zernike amplitudes of a static aberration. Coefficients are in ",(0,n.jsx)(r.strong,{children:"nm RMS"}),". If absent not used."]})]})]})]}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsxs)(r.h3,{id:"1-jitter-jitter_fwhm",children:["1. Jitter (",(0,n.jsx)(r.code,{children:"jitter_FWHM"}),")"]}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["The parameter ",(0,n.jsx)(r.code,{children:"jitter_FWHM"})," defines a Gaussian kernel (FWHM in ",(0,n.jsx)(r.em,{children:"mas"}),") that is convolved with the final PSF.\r\nIt is used to model an additional tip/tilt jitter ( e.g. vibrations, PSF drifts, ...)."]})}),"\n",(0,n.jsx)("div",{style:{borderLeft:"4px solid #4ea3f1",background:"#e8f4ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px"},children:(0,n.jsxs)(r.p,{children:["\u270f\ufe0f ",(0,n.jsx)(r.strong,{children:(0,n.jsx)("i",{children:"Implementation note:"})})," ",(0,n.jsx)("br",{})," This Gaussian convolution is applied at the final stage of\r\nTipTop\u2019s pipeline (in ",(0,n.jsx)(r.a,{href:"https://github.com/astro-tiptop/TIPTOP/blob/d5cceb2d215e81004218b67bca10b6ef87dc8b92/tiptop/baseSimulation.py#L530C9-L530C25",children:(0,n.jsx)("code",{children:"tiptop.baseSimulation.finalConvolution()"})}),")."]})}),"\n",(0,n.jsx)(r.p,{children:"How to define it:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Circular jitter"}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-python",children:"[telescope]\r\njitter_FWHM = 30.0   ; in mas\n"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Elliptical jitter:"}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-python",children:"[telescope]\r\njitter_FWHM = [25.0, 20.0, 30.0]  ; FWHM_X, FWHM_Y [mas], angle [deg]\n"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsxs)(r.strong,{children:["Effects of ",(0,n.jsx)(r.code,{children:"jitter_FWHM"})]})," :"]}),"\n",(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("b",{children:"Broadens the PSF core"})," (direct effect). "]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("b",{children:"Increases the PSF FWHM"})," as the jitter amplitude grows."]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("b",{children:"Reduces the Strehl ratio"}),", since energy leaves the core."]}),(0,n.jsx)("li",{children:(0,n.jsx)("b",{children:"Slightly smooths the halo"})})]}),(0,n.jsxs)(r.p,{children:["Because ",(0,n.jsx)("code",{children:"jitter_FWHM"})," corresponds to tip\u2013tilt\u2013dominated residuals, it mainly acts on\r\nthe lowest spatial frequencies: it widens the core while having minimal effect on the\r\nshape of the outer AO halo."]})]}),"\n",(0,n.jsx)("p",{align:"center",children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"jitter_FWHMa",src:t(2092).A+"",width:"2122",height:"650"})})}),"\n",(0,n.jsxs)("div",{style:{borderLeft:"4px solid #2ed373ff",background:"#f1ffe8ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px",textAlign:"justify"},children:[(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Tuning"})}),(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["In practice, this extra parameter is often added first, then its value is refined after introducing ",(0,n.jsx)("code",{children:"extraError*"})," and\r\n",(0,n.jsx)("code",{children:"zCoefStaticOn"}),", since these parameters also modify the core\u2013halo energy balance\r\n(although through different mechanisms)."]})})]}),"\n",(0,n.jsxs)(r.h3,{id:"2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax",children:["2. Extra high-order error (",(0,n.jsx)(r.code,{children:"extraErrorNm"}),", ",(0,n.jsx)(r.code,{children:"extraErrorExp"}),", ",(0,n.jsx)(r.code,{children:"extraErrorMin"}),", ",(0,n.jsx)(r.code,{children:"extraErrorMax"}),")"]}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"extraError*"})," parameters allow you to introduce an additional, user-defined wavefront error\r\ndescribed by a simple spatial-frequency power law. ",(0,n.jsx)("br",{}),"\r\nThis term is useful to model high-order aberrations not otherwise represented in ",(0,n.jsx)(r.strong,{children:"TipTop"}),", such as\r\nresidual manufacturing erros, residual telescope contributions, or any unmodelled generic high-order\r\nstatic term."]})}),"\n",(0,n.jsx)("div",{style:{borderLeft:"4px solid #4ea3f1",background:"#e8f4ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px",textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["\u270f\ufe0f ",(0,n.jsx)(r.strong,{children:(0,n.jsx)("i",{children:"Implementation note:"})})," ",(0,n.jsx)("br",{}),"\r\nTipTop computes an ",(0,n.jsx)(r.strong,{children:"additional PSD"})," from these\r\nparameters inside ",(0,n.jsx)(r.a,{href:"https://github.com/astro-tiptop/P3/blob/c074643ffa6ddb4b5b2424749a5f10e7d413b6f7/p3/aoSystem/fourierModel.py#L1328",children:(0,n.jsx)("code",{children:"p3.aoSystem.fourierModel.extraErrorPSD()"})}),", and this PSD is then\r\n",(0,n.jsx)("b",{children:"added to the AO PSD"})," in ",(0,n.jsx)(r.a,{href:"https://github.com/astro-tiptop/P3/blob/c074643ffa6ddb4b5b2424749a5f10e7d413b6f7/p3/aoSystem/fourierModel.py#L650",children:(0,n.jsx)("code",{children:"p3.aoSystem.fourierModel.powerSpectrumDensity()"})}),"\r\n(after aliasing, noise, temporal and other contributions).",(0,n.jsx)("br",{}),"\r\nThis provides a straightforward way to inject a generic static high-order\r\naberration PSD into the error budget."]})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Meaning of the parameters"})}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)("ul",{children:[" ",(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"extraErrorNm"})," \u2013 total RMS amplitude (in ",(0,n.jsx)(r.em,{children:"nm"}),") of the additional error"]}),"\r\n",(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"extraErrorExp"})," \u2013 exponent of the power-law spectrum (default \u20132)"]}),"\r\n",(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"extraErrorMin"})," / ",(0,n.jsx)("code",{children:"extraErrorMax"})," \u2013 optional lower/upper spatial-frequency limits (in ",(0,n.jsxs)(r.em,{children:["m",(0,n.jsx)("sup",{children:"\u22121"})]}),")."]})," "]})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsxs)(r.strong,{children:["Effects of the ",(0,n.jsx)(r.code,{children:"extraError*"})," parameters"]})}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)("b",{children:"Strehl ratio reduction"}),(0,n.jsx)(r.br,{}),"\n","Increasing ",(0,n.jsx)("code",{children:"extraErrorNm"})," increases the total WFE and transfers energy\r\nfrom the PSF core into the halo."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)("b",{children:"Encircled-energy modification"}),(0,n.jsx)(r.br,{}),"\n","Higher ",(0,n.jsx)("code",{children:"extraErrorNm"})," values decrease EE at small radii and increase it at larger radii."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)("b",{children:"Halo-shape variation"}),(0,n.jsx)(r.br,{}),"\n","The power-law exponent ",(0,n.jsx)("code",{children:"extraErrorExp"})," controls how energy is distributed across spatial frequencies:","\n",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"steeper (more negative) slopes \u2192 more low-frequency power \u2192 broader halo"}),(0,n.jsx)("li",{children:"shallower slopes \u2192 more high-frequency power \u2192 sharper halo edge"})]}),"\n"]}),"\n"]})}),"\n",(0,n.jsx)("p",{align:"center",children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"ExtraErrorNm",src:t(964).A+"",width:"2122",height:"644"})})}),"\n",(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:["The exponent ",(0,n.jsx)("code",{children:"extraErrorExp"})," determines how quickly the PSD decreases with frequency.",(0,n.jsx)(r.br,{}),"\n","Changing this exponent modifies how energy is redistributed between intermediate and high spatial frequencies, which directly affects the core\u2013to\u2013halo balance."]}),(0,n.jsxs)(r.p,{children:[(0,n.jsx)("code",{children:"extraErrorMin"})," and ",(0,n.jsx)("code",{children:"extraErrorMax"})," further allow you to restrict\r\nthe spatial-frequency range over which the additional error is applied."]})]}),"\n",(0,n.jsx)("p",{align:"center",children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"ExtraErrorM",src:t(2595).A+"",width:"2168",height:"638"})})}),"\n",(0,n.jsxs)("div",{style:{borderLeft:"4px solid #2ed373ff",background:"#f1ffe8ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px",textAlign:"justify"},children:[(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Tuning"})}),(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:["In practice, after adding ",(0,n.jsx)("code",{children:"jitter_FWHM"}),", the\r\n",(0,n.jsx)("code",{children:"extraError*"})," parameters are typically used to adjust the level and shape of the\r\nhalo."]}),(0,n.jsxs)(r.p,{children:["A larger ",(0,n.jsx)("code",{children:"extraErrorNm"})," decreases the Strehl ratio by injecting\r\nadditional high-order wavefront error, thereby raising the halo.",(0,n.jsx)(r.br,{}),"\n","The exponent ",(0,n.jsx)("code",{children:"extraErrorExp"})," then provides finer control over the\r\nhalo slope by redistributing energy between intermediate and high spatial\r\nfrequencies."]}),(0,n.jsxs)(r.p,{children:["Because the effects of several parameters can partially overlap, the tuning process is\r\niterative: modifying ",(0,n.jsx)("code",{children:"extraErrorNm"})," often requires\r\nrevisiting ",(0,n.jsx)("code",{children:"extraErrorExp"}),", and these adjustments must remain\r\nconsistent with any static aberrations introduced through\r\n",(0,n.jsx)("code",{children:"zCoefStaticOn"})," or ",(0,n.jsx)("code",{children:"PathStaticOn"}),"."]}),(0,n.jsxs)(r.p,{children:['In the "MUSE PSF-fitting" example shown below (for a science wavelength of 500',(0,n.jsx)("i",{children:"nm"}),"),\r\nthe effect of ",(0,n.jsx)("code",{children:"extraErrorNm"})," and ",(0,n.jsx)("code",{children:"extraErrorExp"}),"\r\non the radial and directional profiles can be inspected to determine which combination best reproduces the observed halo amplitude and slope.\r\nThe plots illustrate how varying these parameters affect the PSF shape during manual tuning.\r\nFor simplicity, only the X-cut of the PSF is shown here for a single star \u2014\r\nthe objective is purely to visualize the qualitative impact of these parameters.",(0,n.jsx)("br",{}),"\r\n",(0,n.jsx)("i",{children:"Note:"})," the example results correspond to simulations using ",(0,n.jsx)("code",{children:"zCoefStaticOn = [0, 0, 100]"})," (focus term added)."]}),(0,n.jsxs)("p",{align:"center",children:[" ",(0,n.jsx)(r.img,{alt:"ExtraErrorNm_Exp",src:t(9629).A+"",width:"3575",height:"1409"}),"  "]})]})]}),"\n",(0,n.jsxs)(r.h3,{id:"3-static-aberrations-pathstaticon-zcoefstaticon",children:["3. Static aberrations (",(0,n.jsx)("code",{children:"PathStaticOn"}),", ",(0,n.jsx)("code",{children:"zCoefStaticOn"}),")"]}),"\n",(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:["Static aberrations correspond to wavefront errors that are fixed in time and do not evolve\r\nduring the simulation.",(0,n.jsx)(r.br,{}),"\n","In ",(0,n.jsx)("b",{children:"TipTop"}),", to introduce such static terms you can define:"]}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["a user-provided OPD map (",(0,n.jsx)("code",{children:"PathStaticOn"}),")"]}),(0,n.jsxs)("li",{children:["a set of Zernike coefficients (",(0,n.jsx)("code",{children:"zCoefStaticOn"}),")"]})]})]}),"\n",(0,n.jsx)("div",{style:{borderLeft:"4px solid #4ea3f1",background:"#e8f4ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px",textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["\u270f\ufe0f ",(0,n.jsx)("i",{children:(0,n.jsx)("b",{children:"Implementation note:"})}),"  ",(0,n.jsx)("br",{}),"\r\nBoth contributions are combined into an on-axis OPD map (in ",(0,n.jsx)(r.em,{children:"nm"}),") inside the\r\n",(0,n.jsx)("code",{children:"telescope"})," class (attribute ",(0,n.jsx)(r.a,{href:"https://github.com/astro-tiptop/P3/blob/c074643ffa6ddb4b5b2424749a5f10e7d413b6f7/p3/aoSystem/telescope.py#L122",children:(0,n.jsx)("code",{children:"tel.opdMap_on"})}),").\r\nThis OPD map is then applied in the pupil plane when computing the final PSFs, on top of the AO residual\r\nwavefront error."]})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"3.1 Using an OPD map (PathStaticOn)"})}),"\n",(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:[(0,n.jsx)("code",{children:"PathStaticOn"})," allows you to load a static optical path difference map (in ",(0,n.jsx)(r.em,{children:"nm"}),")\r\nfrom a ",(0,n.jsx)(r.code,{children:"FITS"})," file.",(0,n.jsx)(r.br,{}),"\n","It adds a static aberration (it can be used to add any kind of static aberrations)."]}),(0,n.jsxs)(r.p,{children:["This is the recommended approach when you have a measured or simulated aberration map.",(0,n.jsx)("br",{}),"\r\nThe OPD map is rescaled/rotated to match the telescope pupil resolution and geometry and is then\r\nused as an additional OPD term during PSF computation."]})]}),"\n",(0,n.jsxs)(r.p,{children:["One example is the static aberration given by ELT M1 (",(0,n.jsx)(r.a,{href:"https://github.com/astro-tiptop/TIPTOP/blob/main/tiptop/data/ELT_M1_MORFEO_DMs_static_wfe_480px.fits",children:"available here"}),")."]}),"\n",(0,n.jsx)("p",{align:"center",children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"PathStaticOn",src:t(962).A+"",width:"2136",height:"784"})})}),"\n",(0,n.jsx)(r.hr,{}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsxs)(r.strong,{children:["3.2 Using Zernike coefficienrs (",(0,n.jsx)(r.code,{children:"zCoefStaticOn"}),")"]})}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"zCoefStaticOn"})," provides a compact way to introduce a combination of zernike modes that model a static aberration.\r\nThe values are given in ",(0,n.jsx)("i",{children:"nm RMS"})," and follow the standard ",(0,n.jsx)("b",{children:"Noll index"})," ordering (Z2 = tilt, Z3 = tilt, Z4 = defocus, Z5\u2013Z6 = astigmatism, \u2026)."]})}),"\n",(0,n.jsxs)("div",{style:{borderLeft:"4px solid #4ea3f1",background:"#e8f4ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px",textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:["\u270f\ufe0f ",(0,n.jsx)("i",{children:(0,n.jsx)("b",{children:"Implementation note:"})}),(0,n.jsx)(r.br,{}),"\n","Inside ",(0,n.jsx)("code",{children:"telescope"})," class, TipTop:"]}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"builds the corresponding Zernike basis on the pupil,"}),(0,n.jsx)("li",{children:"orthonormalizes the modes on the actual pupil support,"}),(0,n.jsx)("li",{children:"normalizes each mode to 1 nm RMS,"}),(0,n.jsxs)("li",{children:["and finally forms ",(0,n.jsx)("code",{children:"opdMap_on"})," by summing the modes weighted by the coefficients in ",(0,n.jsx)("code",{children:"zCoefStaticOn"}),"."]})]})]}),"\n",(0,n.jsx)(r.p,{children:"Examples:"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{style:{textAlign:"left"},children:"Mode"}),(0,n.jsx)(r.th,{style:{textAlign:"left"},children:(0,n.jsx)(r.code,{children:"zCoefStaticOn"})})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"Focus"}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"[0, 0, 100]"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"Astigmastism"}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"[0, 0, 0, 100]"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"Trefoil"}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"[0, 0, 0, 0, 0, 0, 0, 100]"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"Spherical"}),(0,n.jsx)(r.td,{style:{textAlign:"left"},children:"[0, 0, 0, 0, 0, 0, 0, 0, 0, 100]"})]})]})]}),"\n",(0,n.jsx)("p",{align:"center",children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"Zernike_modes",src:t(7707).A+"",width:"3228",height:"715"})})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Effects of static aberrations"})}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("b",{children:"Strehl ratio degradation"})," \u2014 depending on the total RMS and the Zernike content."]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("b",{children:"PSF shape modification"})," \u2014 Zernike modes introduce directional features (e.g. astigmatism, coma), while arbitrary OPD maps can create more complex patterns."]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("b",{children:"Energy redistribution"})," \u2014 static aberrations alter both the PSF core and halo, with characteristic signatures depending on the aberration type."]})]})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Typical use"})}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["Use ",(0,n.jsx)("code",{children:"PathStaticOn"})," when you have a known, structured pupil-plane aberration\r\n(e.g. calibration-derived NCPA, optics maps, segmented mirror errors). ",(0,n.jsx)("br",{}),"\r\nUse ",(0,n.jsx)("code",{children:"zCoefStaticOn"})," to explore the impact of specific modes (focus, astigmatism, trefoil, \u2026)\r\nor to test simple static error scenarios in a controlled way."]})}),"\n",(0,n.jsxs)("div",{style:{borderLeft:"4px solid #2ed373ff",background:"#f1ffe8ff",padding:"10px 14px",margin:"12px 0",borderRadius:"4px",textAlign:"justify"},children:[(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Tuning"})}),(0,n.jsxs)(r.p,{children:['In our "MUSE tuning example", a set of Zernike coefficients was used together with ',(0,n.jsx)("code",{children:"jitter_FWHM"}),"\r\nand ",(0,n.jsx)("code",{children:"extraError*"})," to reproduce the observed PSF, matching both core width and halo level."]}),(0,n.jsxs)(r.p,{children:["The example below illustrates the impact of adding a simple defocus term via\r\n",(0,n.jsx)("code",{children:"zCoefStaticOn = [0, 0, 100]"})," on the PSF shape (X-cut only, for clarity)."]}),(0,n.jsx)("p",{align:"center",children:(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"zCoefStaticOn",src:t(8816).A+"",width:"490",height:"389"})})})]}),"\n",(0,n.jsxs)("p",{children:[(0,n.jsx)("b",{children:"Note on wavelength:"})," the sensitivity of PSF features to these parameters\r\ndepends on the simulation wavelength. Users should perform comparisons at the wavelength(s)\r\nmost relevant for their science case, as different wavelengths emphasise different spatial\r\nfrequency ranges of the PSF."]}),"\n","\n","\n","\n","\n","\n",(0,n.jsx)(r.h2,{id:"-useful-scripts",children:"\ud83d\udcc4 Useful Scripts"}),"\n",(0,n.jsxs)(r.h3,{id:"-run-n-tiptop-simulations-with-different-parameter-values",children:["\ud83d\udd35 Run ",(0,n.jsx)("i",{children:"N"})," ",(0,n.jsx)(r.strong,{children:"TipTop"})," Simulations with Different Parameter Values"]}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["Here, we provide an example script to run ",(0,n.jsx)("i",{children:"N"})," ",(0,n.jsx)(r.strong,{children:"TipTop"})," simulations with different values of two parameters:\r\n",(0,n.jsx)(r.code,{children:"ZenithAngle"})," and ",(0,n.jsx)(r.code,{children:"Seeing"}),". The script can easily be adapted to sweep over a single parameter or more than two."]})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Download the script:"}),"\r\n",(0,n.jsx)("a",{href:`${(0,a.Ay)("/downloads/TIPTOP_RUN_N_SIM.py")}`,download:"TIPTOP_RUN_N_SIM.py",children:(0,n.jsx)("span",{style:{fontSize:"1.5em"},children:"\ud83d\udce5"})}),"."]}),"\n",(0,n.jsxs)(i,{children:[(0,n.jsx)("summary",{children:(0,n.jsxs)("strong",{children:[" Running ",(0,n.jsx)("i",{children:"N"})," ",(0,n.jsx)(r.strong,{children:"TipTop"})," simulations: ",(0,n.jsx)(r.code,{children:"TIPTOP_RUN_N_SIM.py"})," "]})}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-python",children:'"""\r\nCreated on Thu Jul 10 10:00:34 2025\r\nRun N TIPTOP simulations by sweeping over different parameter values.\r\n\r\n@author: astro-tiptop-services\r\n"""\r\n\r\n#%% =============================================================================\r\n# Import necessary libraries\r\nfrom tiptop.tiptop import overallSimulation\r\nimport numpy as np\r\nimport configparser\r\nfrom itertools import product\r\nimport os\r\n\r\n#%% =============================================================================\r\n# === File Paths ===\r\n#\ud83d\udca1 Adapt these paths to your environment\r\ninputDir = "../MICADO/"   # Folder containing the .ini parameter file\r\ninTag = "MICADO_SCAO"     # Name of the input parameter file (without extension)\r\noutputDir = "./"          # Folder where the output FITS files will be saved \r\ntempDir = inputDir        # Temporary folder for modified .ini files\r\ntempName = \'file_temp\'    # Name of the temporary file\r\n\r\n# Construct the full path to the input and temporary config files\r\ninputFile = os.path.join(inputDir, f"{inTag}.ini")\r\ntempFile = os.path.join(tempDir, f"{tempName}.ini")\r\n\r\n# Base name for output files\r\noutTagBase = "MICADO"\r\n\r\n#%% =============================================================================\r\n# === Define parameters to sweep ===\r\n# \ud83d\udca1 Format: (section_name, key_name, list_of_values : min, max, number of values)\r\nparam_sweep = [\r\n  ("atmosphere", "Seeing", np.linspace(0.8, 2.0, 3)),\r\n  ("telescope", "ZenithAngle", np.linspace(0.0, 60.0, 3)),\r\n  # Add more parameters as needed\r\n]\r\n\r\n#%% =============================================================================\r\n# === Read base configuration file ===\r\nparser = configparser.ConfigParser()\r\nparser.optionxform = str # Keep the original case of parameter keys\r\nparser.read(inputFile)\r\n\r\n#%% =============================================================================\r\n# === Build and run combinations ===\r\n\r\n# Extract parameter names and values\r\nparam_names = [f"{sec}.{key}" for sec, key, _ in param_sweep]\r\nparam_values = [vals for _, _, vals in param_sweep]\r\n\r\n# Generate all combinations\r\nfor combo in product(*param_values):\r\n  # Update .ini with current parameter values\r\n  for (section, key, _), value in zip(param_sweep, combo):\r\n      parser.set(section, key, str(value))\r\n            \r\n      # Write updated config to temporary .ini file\r\n      with open(tempFile, "w") as configfile:\r\n          parser.write(configfile)\r\n      \r\n      # Build output file tag\r\n      tag_parts = [f"{name.split(\'.\')[-1]}{val:.2f}" for name, val in zip(param_names, combo)]\r\n      tag = f"{outTagBase}_{\'_\'.join(tag_parts)}"\r\n      \r\n      print(f"\ud83d\udd04 Running simulation with: {dict(zip(param_names, combo))}")\r\n      \r\n      # Run TipTop simulation\r\n      overallSimulation(\r\n          path2param=tempDir,\r\n          parametersFile=tempName,\r\n          outputDir=outputDir,\r\n          outputFile=tag,\r\n          addSrAndFwhm=True\r\n      )\n'})})]}),"\n",(0,n.jsx)(r.h3,{id:"-rename-output-fits-files-and-keep-backups",children:"\ud83d\udd35 Rename Output FITS Files and Keep Backups"}),"\n",(0,n.jsx)("div",{style:{textAlign:"justify"},children:(0,n.jsxs)(r.p,{children:["This script renames PSF FITS files (e.g., those generated by the previous script)\r\nto facilitate their use in other routines, while creating backups of the originals.\r\nFor example, it renames FITS files in your folder starting with the tag MICADO\r\nto simple, easily readable names like ",(0,n.jsx)(r.code,{children:"MICADO_PSF1.fits"}),", ",(0,n.jsx)(r.code,{children:"MICADO_PSF2.fits"}),", and so on."]})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Download the script:"}),"\r\n",(0,n.jsx)("a",{href:`${(0,a.Ay)("/downloads/TIPTOP_rename_psf_files.py")}`,download:"TIPTOP_rename_psf_files.py",children:(0,n.jsx)("span",{style:{fontSize:"1.5em"},children:"\ud83d\udce5"})})]}),"\n",(0,n.jsxs)(i,{children:[(0,n.jsx)("summary",{children:(0,n.jsxs)("strong",{children:[" Rename output PSF FITS files: ",(0,n.jsx)(r.code,{children:"TIPTOP_rename_psf_files.py"})," "]})}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-python",children:'"""\r\nCreated on Thu Jul 10 14:15:45 2025\r\nRename output PSF FITS files sequentially for easier access and keep original copies.\r\n\r\n@author: astro-tiptop-services\r\n"""\r\n\r\n#%% =============================================================================\r\n# Import necessary libraries\r\nimport os\r\nimport shutil\r\n\r\n#%% =============================================================================\r\n# === Configuration ===\r\n#\ud83d\udca1 Adapt these paths to your environment\r\ninputDir = "./"    # Directory containing the generated FITS files \r\nbackupDir = "Original_PSFs"  # Directory to store backups of original files\r\noutputDir = "Renamed_PSFs" # Directory where renamed files will be moved (must exist)\r\n\r\nTagBase = "MICADO"     # Base name used in the output FITS filenames\r\n\r\n# Create output and backup directories if they do not exist\r\nos.makedirs(outputDir, exist_ok=True)\r\nos.makedirs(backupDir, exist_ok=True)\r\n\r\n#%% =============================================================================\r\n# === Gather and sort relevant FITS files ===\r\noutput_files = sorted(\r\n  [f for f in os.listdir(inputDir) if f.startswith(TagBase) and f.endswith(".fits")]\r\n)\r\n\r\n# Check if any matching files are found\r\nif not output_files:\r\n  print("[INFO] No matching FITS files found for renaming.")\r\nelse:\r\n  print(f"[INFO] Found {len(output_files)} FITS files to rename.")\r\n\r\n#%% =============================================================================\r\n# === Copy and Rename files sequentially as TagBase_PSF1.fits, MICADO_PSF2.fits, etc. ===\r\nfor i, fname in enumerate(output_files):\r\n  src = os.path.join(inputDir, fname)\r\n  dst = os.path.join(outputDir, f"{TagBase}_PSF{i+1}.fits")\r\n  backup = os.path.join(backupDir, fname)\r\n\r\n  try:\r\n      # Copy the original file to the backup folder\r\n      shutil.copy2(src, backup)\r\n\r\n      # Rename (and move) the file to the new destination\r\n      os.rename(src, dst)\r\n      print(f"[INFO] Renamed: {fname} \u2192 {TagBase}_PSF{i+1}.fits (Backup saved)")\r\n  except PermissionError:\r\n      print(f"[\u26a0\ufe0f  WARNING] File in use and cannot be renamed: {fname}")\r\n  except Exception as e:\r\n      print(f"[\u274c ERROR] Failed to rename {fname} \u2192 {e}")\r\n\r\n#%% =============================================================================\r\nprint(f"\\n\u2705 Process complete. {len(output_files)} files renamed and backed up.")\r\n\n'})})]}),"\n",(0,n.jsx)(r.h3,{id:"-sum-rotated-psf",children:"\ud83d\udd35 Sum rotated PSF"}),"\n",(0,n.jsxs)("div",{style:{textAlign:"justify"},children:[(0,n.jsxs)(r.p,{children:["This script combines multiple PSFs into a single image by rotating each individual PSF\r\nby a specified field rotation angle before summation. ",(0,n.jsx)("br",{}),"\r\nUsed together with the two previous scripts, this process can be\r\nespecially useful, for example, when simulating long integrations to reproduce the impact of pupil rotation and field rotation on the final image."]}),(0,n.jsxs)(r.p,{children:["\u270f\ufe0f ",(0,n.jsx)(r.strong,{children:"Note"}),": You need to manually define the list of field rotation angles in the script \u2014 one angle per PSF FITS file.",(0,n.jsx)("br",{}),"\r\nFeel free to adapt this script to suit TipTop simulations involving multiple science sources.\r\nThe example provided here illustrates its use with the input parameter file\r\n",(0,n.jsx)(r.a,{href:"/docs/orion/aoinstruments#micado",children:"MICADO.ini"}),". ",(0,n.jsx)("br",{})]})]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Download the script:"}),"\r\n",(0,n.jsx)("a",{href:`${(0,a.Ay)("/downloads/TIPTOP_rotated_PSF_sum.py")}`,download:"TIPTOP_rotated_PSF_sum.py",children:(0,n.jsx)("span",{style:{fontSize:"1.5em"},children:"\ud83d\udce5"})})]}),"\n",(0,n.jsxs)(i,{children:[(0,n.jsx)("summary",{children:(0,n.jsxs)("strong",{children:[" Sum rotated AO PSFs: ",(0,n.jsx)(r.code,{children:"TIPTOP_rotated_PSF_sum.py"})," "]})}),(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-python",children:'"""\r\nCreated on Thu Jul 10 15:01:55 2025\r\nSum rotated PSFs.\r\nEach PSF is rotated by a specified angle before summation.\r\n\r\n@author: astro-tiptop-services\r\n"""\r\n\r\n#%% =============================================================================\r\n# Import necessary libraries\r\nimport os\r\nimport numpy as np\r\nfrom scipy.ndimage import rotate\r\nfrom astropy.io import fits\r\n\r\n#%% =============================================================================\r\n# === Configuration ===\r\ninputDir = "Renamed_PSFs"           # Folder where the PSF FITS files are stored\r\nTagBase = "MICADO"                  # Base tag for the PSF files\r\noutputFile = "PSF_sum.fits"         # Filename for the combined output\r\n\r\n# Rotation angles (degrees) applied to each PSF before summation\r\nrotation_angles = [...] # \ud83d\udca1 To be defined\r\nN = len(rotation_angles)  # Should match the number of PSF files available\r\n\r\n#%% =============================================================================\r\n# === Load and combine rotated PSFs ===\r\nfirst_filename = os.path.join(inputDir, f"{TagBase}_PSF1.fits")\r\nif not os.path.exists(first_filename):\r\n  raise FileNotFoundError(f"Base file {first_filename} is missing. Check input directory.")\r\n\r\nfirst_img = fits.getdata(first_filename)\r\naccumulated = np.zeros_like(first_img, dtype=float)  # Accumulator for summing rotated PSFs\r\nvalid_count = 0  # Count how many files were found and used\r\n\r\n# Loop over all images and angles\r\nfor i in range(N):\r\n  filename = os.path.join(inputDir, f\'{TagBase}_PSF{i+1}.fits\')\r\n\r\n  # Check if file exists\r\n  if not os.path.exists(filename):\r\n      print(f"[WARNING] Missing file: {filename}")\r\n      continue\r\n\r\n  print(f"[INFO] Loading file: {filename}")\r\n  img = fits.getdata(filename)\r\n\r\n  # Rotate the image by the corresponding angle\r\n  rotated = rotate(img, angle=rotation_angles[i], reshape=False)\r\n\r\n  # Accumulate the rotated image\r\n  accumulated += rotated\r\n  valid_count += 1\r\n\r\n#%% =============================================================================\r\n# === Normalize and save result ===\r\nif valid_count > 0:\r\n  accumulated /= valid_count\r\n\r\n  # Save PSF sum to a FITS file, overwrite if exists\r\n  fits.writeto(outputFile, accumulated, overwrite=True)\r\n  print(f"[INFO] Combined PSF saved to: {outputFile}")\r\nelse:\r\n  print("[ERROR] No valid PSF files found. No output generated.")\r\n\n'})})]})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},7707:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/zernike_poly-8434641d068bd002ca545fd69db57bdc.png"},8453:(e,r,t)=>{t.d(r,{R:()=>a,x:()=>o});var i=t(6540);const n={},s=i.createContext(n);function a(e){const r=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),i.createElement(s.Provider,{value:r},e.children)}},8816:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/zCoefStaticOn-ee4f24ab3995e315dff1810d4215e2d1.jpg"},9629:(e,r,t)=>{t.d(r,{A:()=>i});const i=t.p+"assets/images/extraErrorNm_Exp-549fbfdb56b2b3a1dccdea6c843ff589.jpg"}}]);