"use strict";(self.webpackChunktiptop_site=self.webpackChunktiptop_site||[]).push([[9605],{7769:(e,t,s)=>{s.d(t,{A:()=>l});const l=s.p+"assets/images/pipeline_ast-90094d40e61c0c54fe07face25f88bff.png"},8453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>d});var l=s(6540);const i={},n=l.createContext(i);function r(e){const t=l.useContext(n);return l.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(n.Provider,{value:t},e.children)}},9995:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"aquila/running_selection","title":"Running asterism selections","description":"\ud83d\udcd1 Pipeline","source":"@site/docs/aquila/running_selection.md","sourceDirName":"aquila","slug":"/aquila/running_selection","permalink":"/astro-tiptop-services/docs/aquila/running_selection","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"running_selection","title":"Running asterism selections","sidebar_label":"Running selections"},"sidebar":"tipTopSidebar","previous":{"title":"Parameter files - [ASTERISM_SELECTION]","permalink":"/astro-tiptop-services/docs/aquila/parameterfiles"},"next":{"title":"Heuristic models","permalink":"/astro-tiptop-services/docs/aquila/heuristic_models"}}');var i=s(4848),n=s(8453);const r={id:"running_selection",title:"Running asterism selections",sidebar_label:"Running selections"},d=void 0,c={},o=[{value:"\ud83d\udcd1 Pipeline",id:"-pipeline",level:2},{value:"\ud83d\udcc8 <code>asterismSelection</code> function",id:"-asterismselection-function",level:2},{value:"Parameters (highlights)",id:"parameters-highlights",level:3},{value:"\u2728 What does <code>asterismSelection</code> produce?",id:"-what-does-asterismselection-produce",level:2},{value:"Return values",id:"return-values",level:3},{value:"Files written to <code>outputDir</code>",id:"files-written-to-outputdir",level:4}];function a(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components},{Details:l}=t;return l||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"-pipeline",children:"\ud83d\udcd1 Pipeline"}),"\n",(0,i.jsx)("p",{align:"center",children:(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:s(7769).A+"",width:"4246",height:"1499"})})}),"\n",(0,i.jsxs)(t.h2,{id:"-asterismselection-function",children:["\ud83d\udcc8 ",(0,i.jsx)(t.code,{children:"asterismSelection"})," function"]}),"\n",(0,i.jsxs)(t.p,{children:["Once your .ini has an ",(0,i.jsx)(t.code,{children:"[ASTERISM_SELECTION]"})," section, run the evaluation with:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"tiptop.asterismSelection(simulName, path2param, parametersFile, outputDir, outputFile, doPlot=False, \r\n                         returnRes=False, returnMetrics=True, addSrAndFwhm=True, verbose=False,\r\n                         getHoErrorBreakDown=False, ensquaredEnergy=False, eeRadiusInMas=50, \r\n                         doConvolve=False, plotInComputeAsterisms=False, progressStatus=False, gpuIndex=0):\n"})}),"\n",(0,i.jsx)(t.h3,{id:"parameters-highlights",children:"Parameters (highlights)"}),"\n",(0,i.jsxs)(l,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:" Parameters "})}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"simulName"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"str"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2713"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Short name used as prefix when saving arrays (e.g. ",(0,i.jsx)(t.code,{children:"simulName+'sr.npy'"}),")."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"path2param"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"str"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2713"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Path to the parameter file."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"parametersFile"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"str"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2713"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Name of the parameter file to be used without the extention."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"outputDir"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"str"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2713"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Path to the folder in which to write the output."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"outputFile"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"str"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2713"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Base FITS filename if results are saved as images elsewhere in the pipeline."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"doPlot"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want to see the result in python set this to ",(0,i.jsx)(t.code,{children:"True"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"returnRes"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If ",(0,i.jsx)(t.code,{children:"True"}),", return (HO, LO) residuals per asterism and the simulation object."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"returnMetrics"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"True"}),", The function will return Strehl Ratio, fwhm, encircled energy within eeRadiusInMas, covariance ellipses and the simulation object, if set to ",(0,i.jsx)(t.code,{children:"True"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"addSrAndFwhm"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"True"}),", The function will add in the header of the fits file SR anf FWHM for each PSF."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"verbose"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want all messages set this to ",(0,i.jsx)(t.code,{children:"True"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"getHoErrorBreakDown"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want HO error breakdown set this to ",(0,i.jsx)(t.code,{children:"True"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"ensquaredEnergy"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"float"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want ensquared energy instead of encircled energy set this to ",(0,i.jsx)(t.code,{children:"True"}),"."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"eeRadiusInMas"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": 50, Used together with ",(0,i.jsx)(t.code,{children:"returnMetrics"}),", radius used for the computation of the encirlced energy."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"doConvolve"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want to use the natural convolution operation set to True."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"plotInComputeAsterisms"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want to display asterisms."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"progressStatus"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"bool"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": ",(0,i.jsx)(t.code,{children:"False"}),", If you want to display progress status."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.code,{children:"gpuIndex"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"integer"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"optional"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.em,{children:"Default"}),": 0, Target GPU index where the simulation will be run."]})]})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["\u26a0\ufe0f Prerequisites: your .ini must have a valid ",(0,i.jsx)(t.a,{href:"/astro-tiptop-services/docs/aquila/parameterfiles",children:(0,i.jsx)(t.code,{children:"[ASTERISM_SELECTION]"})})," and the LO loop must be on (valid ",(0,i.jsx)(t.a,{href:"/docs/orion/parameterfiles#sensor_LO",children:(0,i.jsx)(t.code,{children:"[sensor_LO]"})})," section)."]}),"\n",(0,i.jsxs)(t.h2,{id:"-what-does-asterismselection-produce",children:["\u2728 What does ",(0,i.jsx)(t.code,{children:"asterismSelection"})," produce?"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"tiptop.asterismSelection(...)"})," evaluates every candidate asterism and returns/saves ",(0,i.jsx)(t.strong,{children:"image-quality metrics per asterism"}),", plus a simulation object you can reuse."]}),"\n",(0,i.jsx)(t.h3,{id:"return-values",children:"Return values"}),"\n",(0,i.jsx)(t.p,{children:"Depending on the flags, you typically get:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"sr, fw, ee, covs, simul = tiptop.asterismSelection(...,\r\n    returnRes=False,   # set True to also get residuals (see below)\r\n    returnMetrics=True # default=True\r\n)\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"sr"}),": Strehl Ratio per asterism (unitless, \u2208 [0,1])."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"fw"}),": FWHM per asterism (in milliarcseconds, mas)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ee"}),": Encircled Energy per asterism, measured within eeRadiusInMas (fraction \u2208 [0,1])."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"covs"}),": covariance ellipses per asterism (per science target; used for anisotropy/jitter visualizations)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"simul"}),": the simulation object (class asterismSimulation) holding inputs, indices, and cached arrays."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["If you pass ",(0,i.jsx)(t.code,{children:"returnRes=True"}),", the function also returns residual terms (HO/LO) per asterism alongside the simulation object. These are the raw residuals produced by the AO pipeline and are useful for diagnostics (e.g., breaking down error sources). Units and exact shapes depend on your AO configuration (number of science targets, WFS setup, etc.)."]}),"\n",(0,i.jsxs)(t.p,{children:["\u270f\ufe0f ",(0,i.jsx)(t.strong,{children:"Note on shapes"}),". Metrics are computed per ",(0,i.jsx)(t.strong,{children:"science target"}),".\r\nIf you configured multiple science directions, each asterism entry contains one value per target (e.g. ",(0,i.jsx)(t.code,{children:"sr[asterism_idx, target_idx]"}),"). The first target (",(0,i.jsx)(t.code,{children:"[..., 0]"}),") is often the \u201con-axis\u201d metric. With a single science target, arrays reduce to length ",(0,i.jsx)(t.code,{children:"nAsterisms"}),"."]}),"\n",(0,i.jsxs)(t.h4,{id:"files-written-to-outputdir",children:["Files written to ",(0,i.jsx)(t.code,{children:"outputDir"})]}),"\n",(0,i.jsxs)(t.p,{children:["For convenience and faster reloads, the following arrays are saved with the prefix ",(0,i.jsx)(t.code,{children:"simulName"}),":"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"File"}),(0,i.jsx)(t.th,{children:"Contains"}),(0,i.jsx)(t.th,{children:"Notes"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"simulName + 'sr.npy'"})}),(0,i.jsx)(t.td,{children:"Strehl Ratio per asterism (per target)"}),(0,i.jsx)(t.td,{children:"unitless"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"simulName + 'fw.npy'"})}),(0,i.jsx)(t.td,{children:"FWHM per asterism (per target)"}),(0,i.jsx)(t.td,{children:"mas"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"simulName + 'ee.npy'"})}),(0,i.jsx)(t.td,{children:"Encircled energy per asterism (per target)"}),(0,i.jsx)(t.td,{children:"fraction"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"simulName + 'covs.npy'"})}),(0,i.jsx)(t.td,{children:"Covariance ellipses per asterism (per target)"}),(0,i.jsx)(t.td,{children:"used for PSF anisotropy/jitter"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"simulName + 'penalty.npy'"})}),(0,i.jsx)(t.td,{children:"Scalar ranking metric per asterism"}),(0,i.jsx)(t.td,{children:"lower is better"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:"\u2b07\ufe0f You can reload them without recomputing via:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"sr, fw, ee, covs, simul = reloadAsterismSelection(simulName=SIMUL_NAME,path2param=PARAMS_DIR,\r\n                                                  parametersFile=INI_BASENAME, outputDir=OUTPUT_DIR,\r\n                                                  outputFile='psf', doPlot=False,\r\n                                                  returnRes=False, returnMetrics=True,\r\n                                                  addSrAndFwhm=True, verbose=False,\r\n                                                  getHoErrorBreakDown=False, ensquaredEnergy=False,\r\n                                                  eeRadiusInMas=50, gpuIndex=GPU_INDEX)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["For a step-by-step run, see ",(0,i.jsx)(t.a,{href:"/astro-tiptop-services/docs/aquila/tuto_ast_select",children:(0,i.jsx)(t.strong,{children:"Tutorial - Asterism Seclection"})}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);