<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-orion/useful_scripts" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Tutorials Useful &amp; Scripts | Astro-TipTop Services</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://astro-tiptop-services.github.io/astro-tiptop-services/img/logo_astro_tiptop.png"><meta data-rh="true" name="twitter:image" content="https://astro-tiptop-services.github.io/astro-tiptop-services/img/logo_astro_tiptop.png"><meta data-rh="true" property="og:url" content="https://astro-tiptop-services.github.io/astro-tiptop-services/docs/orion/useful_scripts"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="application-name" content="Astro TipTop Services"><meta data-rh="true" name="google-site-verification" content="xup3nZWe_TurfujsJeQWHBoOL5Vm1eEYYxLbfe1uWso"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tutorials Useful &amp; Scripts | Astro-TipTop Services"><meta data-rh="true" name="description" content="This section provides a collection of useful scripts and detailed tutorials designed to help you"><meta data-rh="true" property="og:description" content="This section provides a collection of useful scripts and detailed tutorials designed to help you"><link data-rh="true" rel="icon" href="/astro-tiptop-services/img/logo_astro-tiptop_cropped.png"><link data-rh="true" rel="canonical" href="https://astro-tiptop-services.github.io/astro-tiptop-services/docs/orion/useful_scripts"><link data-rh="true" rel="alternate" href="https://astro-tiptop-services.github.io/astro-tiptop-services/docs/orion/useful_scripts" hreflang="en"><link data-rh="true" rel="alternate" href="https://astro-tiptop-services.github.io/astro-tiptop-services/docs/orion/useful_scripts" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","@id":"https://astro-tiptop-services.github.io/astro-tiptop-services#org","name":"Astro TipTop Services","alternateName":["Astro TipTop","Astro TipTop Services","Astro-TipTop","TipTop"],"url":"https://astro-tiptop-services.github.io/astro-tiptop-services/","logo":{"@type":"ImageObject","@id":"https://astro-tiptop-services.github.io/astro-tiptop-services#logo","url":"https://astro-tiptop-services.github.io/astro-tiptop-services/img/logo_astro-tiptop_cropped.png","width":256,"height":256},"sameAs":["https://github.com/astro-tiptop/TIPTOP","https://pypi.org/project/astro-tiptop/"]}</script><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","@id":"https://astro-tiptop-services.github.io/astro-tiptop-services#website","url":"https://astro-tiptop-services.github.io/astro-tiptop-services/","name":"Astro TipTop Services","potentialAction":{"@type":"SearchAction","target":"https://astro-tiptop-services.github.io/astro-tiptop-services/?q={search_term_string}","query-input":"required name=search_term_string"}}</script><link rel="alternate" type="application/rss+xml" href="/astro-tiptop-services/blog/rss.xml" title="Astro-TipTop Services RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/astro-tiptop-services/blog/atom.xml" title="Astro-TipTop Services Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-mll67QQEJgVtGqxW9VD7q2GqNzMIk1CjATaF2nUgA7HgS43l+ZFV2DkVKkW0nU3g" crossorigin="anonymous"><link rel="stylesheet" href="/astro-tiptop-services/assets/css/styles.afbc34ce.css">
<script src="/astro-tiptop-services/assets/js/runtime~main.deb99c6d.js" defer="defer"></script>
<script src="/astro-tiptop-services/assets/js/main.8356142b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/astro-tiptop-services/"><div class="navbar__logo"><img src="/astro-tiptop-services/img/logo_astro-tiptop_cropped.png" alt="Astro-TipTop Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="100"><img src="/astro-tiptop-services/img/logo_astro-tiptop_cropped.png" alt="Astro-TipTop Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="100"></div><b class="navbar__title text--truncate">Astro-TipTop Services</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" sidebarid="generalSidebar" href="/astro-tiptop-services/docs/general/whatistiptop">General Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/astro-tiptop-services/docs/general/whatistiptop">What is TipTop?</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/general/howdoestiptopwork">How does TipTop work?</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/general/whatcanitbeusedfor">What can it be used for?</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/general/error_breakdown">What is included in TipTop?</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/general/installation">How to install TipTop?</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" sidebarid="tipTopSidebar" href="/astro-tiptop-services/astro_tiptop_modules">Astro-TipTop Features</a><ul class="dropdown__menu"><li><a class="dropdown__link menu-section-header" href="/astro-tiptop-services/docs/orion/overview">TipTop | Core Functionality</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/orion/usage">‚Ä¢ Quickstart</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/orion/howtosetuplaunchfile">‚Ä¢ Set Up a Launch Script for TipTop and Display Results</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/orion/howtosetup">‚Ä¢ Set Up TipTop According to the OA Mode</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/orion/aoinstruments">‚Ä¢ Available AO instruments - Input Files and Corresponding Results </a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/orion/interactivetools">‚Ä¢ Interactive tools - Generate Input Files &amp; Convert Parameters</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/astro-tiptop-services/docs/orion/useful_scripts">‚Ä¢ Tutorials &amp; Useful Scripts</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/orion/parameterfiles">‚Ä¢ Parameter files explained</a></li><li><a class="dropdown__link menu-section-header" href="/astro-tiptop-services/docs/aquila/overview">TipTop | Asterism selection</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/aquila/parameterfiles">‚Ä¢ Parameter files - [ASTERISM_SELECTION]</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/aquila/running_selection">‚Ä¢ Running selections</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/aquila/heuristic_models">‚Ä¢ Heuristic models</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/docs/aquila/tuto_ast_select">‚Ä¢ Tutorial - Asterism Selection</a></li><li><a class="dropdown__link menu-section-header" href="/astro-tiptop-services/docs/lyra/overview">TipTop | PSF Fitting / PSF Extrapolation</a></li><li><a class="dropdown__link menu-section-header" href="/astro-tiptop-services/docs/phoenix/overview">TipTop | PSF-R service</a></li></ul></div><a class="navbar__item navbar__link" href="/astro-tiptop-services/blog">News &amp; Updates</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" sidebarid="Resources">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/astro-tiptop-services/resources/about_us">About us</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/references">Key Publications &amp; References</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/users">Users Area</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/contributors">Contributors Area</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/wishlist">Wish list</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/AO_school">AO school</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/internship_opportunities">Internship Opportunities</a></li><li><a class="dropdown__link" href="/astro-tiptop-services/resources/contact">Contact Support</a></li></ul></div><a class="navbar__item navbar__link" href="/astro-tiptop-services/terms">Terms &amp; Conditions</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/astro-tiptop/TIPTOP" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/astro-tiptop-services/astro_tiptop_modules">Astro-TipTop Features</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/astro-tiptop-services/docs/orion/overview">TipTop | Core Functionality</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/usage">Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/howtosetuplaunchfile">Set Up a Launch Script for TipTop and Display Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/howtosetup">Set Up TipTop According to the AO Mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/aoinstruments">Available AO instruments - Input Files and Corresponding Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/interactivetools">Interactive tools ‚Äì Generate Input Files &amp; Convert Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/astro-tiptop-services/docs/orion/useful_scripts">Tutorials &amp; Useful Scripts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/astro-tiptop-services/docs/orion/parameterfiles">Parameter files explained</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/astro-tiptop-services/docs/aquila/overview">TipTop | Asterism selection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/astro-tiptop-services/docs/lyra/overview">TipTop | PSF Fitting / PSF Extrapolation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/astro-tiptop-services/docs/phoenix/overview">TipTop | PSF-R Service</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/astro-tiptop-services/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TipTop | Core Functionality</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tutorials &amp; Useful Scripts</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tutorials Useful &amp; Scripts</h1></header><div style="text-align:justify"><p>This section provides a collection of useful scripts and detailed tutorials designed to help you
run, extend, and better understand <b>TipTop</b> simulations for your own applications.</p></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-tutorials">üìù Tutorials<a href="#-tutorials" class="hash-link" aria-label="Direct link to üìù Tutorials" title="Direct link to üìù Tutorials">‚Äã</a></h2>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-understanding-additional-error-terms-in-tiptop-jitter-extra-error-and-static-aberrations">  üîµ Understanding Additional Error Terms in TipTop (Jitter, Extra Error and Static aberrations)<a href="#-understanding-additional-error-terms-in-tiptop-jitter-extra-error-and-static-aberrations" class="hash-link" aria-label="Direct link to üîµ Understanding Additional Error Terms in TipTop (Jitter, Extra Error and Static aberrations)" title="Direct link to üîµ Understanding Additional Error Terms in TipTop (Jitter, Extra Error and Static aberrations)">‚Äã</a></h3>
<div style="text-align:justify"><p>This tutorial introduces the optional parameters that can be activated in <b>TipTop</b>
to enrich simulated PSFs with additional, user-defined error contributions.<br>
<!-- -->These parameters allow you to represent effects that are not otherwise considered by <strong>TipTop</strong>, such as
non common path aberrations (NCPA), manufacturing tolerances, phasing errors in pupil segmented systems, or residual vibrations, ...</p><p>These configurable parameters can help you to produce more realistic PSFs, test ‚Äúwhat-if‚Äù error budgets, or reproduce measured PSFs for specific analyses. <br>
Part of the purpose of this tutorial is therefore to illustrate which regions of the PSF
(core width, halo level, etc.) are most sensitive to each additional error term.<br>
<!-- -->However, several effects can overlap, and the impact of individual parameters is sometimes
difficult to distinguish by eye. As a result, manual tuning often requires iterating and
revisiting parameters more than once. Because some error terms may compensate or mask each other, caution is recommended.
Before introducing new aberrations, users should refer to the page
<i>‚Äú<a href="/astro-tiptop-services/docs/general/error_breakdown">What is included in TipTop?</a>‚Äù</i> to avoid adding errors that are already taken into account.</p></div>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-the-main-parameters">Overview of the main parameters<a href="#overview-of-the-main-parameters" class="hash-link" aria-label="Direct link to Overview of the main parameters" title="Direct link to Overview of the main parameters">‚Äã</a></h3>
<table><thead><tr><th style="text-align:left">Parameter</th><th style="text-align:left">Required?</th><th style="text-align:center">Type</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><code>jitter_FWHM</code></td><td style="text-align:left">No</td><td style="text-align:center"><code>float</code></td><td style="text-align:left"><em>Default:</em> <code>None</code>, Additional kernel to be convolved with PSF, it could be a scalar (FWHM in <strong>mas</strong>) for a round kernel or a list of three values <code>[FWHM_mas_max, FWHM_mas_min, angle_rad]</code>.</td></tr><tr><td style="text-align:left"><code>extraErrorNm </code></td><td style="text-align:left">No</td><td style="text-align:center"><code>float</code></td><td style="text-align:left"><em>Default:</em> <code>0</code>, <strong>nm RMS</strong> of the additional wavefront error to be added (an error that is not otherwise considered).</td></tr><tr><td style="text-align:left"><code>extraErrorExp</code></td><td style="text-align:left">No</td><td style="text-align:center"><code>float</code></td><td style="text-align:left"><em>Default:</em> <code>-2</code>, Exponent of the power of spatial frequencies used to generate the PSD associated with <code>extraErrorNm</code>.</td></tr><tr><td style="text-align:left"><code>extraErrorMin</code></td><td style="text-align:left">No</td><td style="text-align:center"><code>float</code></td><td style="text-align:left"><em>Default:</em> <code>0</code>, Minimum spatial frequency <code>[m<sup>‚àí1</sup>]</code> for which PSD associated with <code>extraErrorNm</code> is <code>&gt; 0</code>.</td></tr><tr><td style="text-align:left"><code>extraErrorMax</code></td><td style="text-align:left">No</td><td style="text-align:center"><code>float</code></td><td style="text-align:left"><em>Default:</em> <code>0</code>, Maximum spatial frequency <code>[m<sup>‚àí1</sup>]</code> for which PSD associated with <code>extraErrorNm</code> is <code>&gt; 0</code>. <br> <em>Note</em>: <code>0</code> means maximum frequency is the one present in the spatial frequency array of the PSDs.</td></tr><tr><td style="text-align:left"><code>PathStaticOn</code></td><td style="text-align:left">No</td><td style="text-align:center"><code>string</code></td><td style="text-align:left"><em>Default:</em> <code>None</code>, Path to a map of static aberrations (<strong>nm</strong>) in .fits file. If absent or <code>‚Äò‚Äô</code>, not used.</td></tr><tr><td style="text-align:left"><code>zCoefStaticOn</code></td><td style="text-align:left">No</td><td style="text-align:center"><code>list</code></td><td style="text-align:left"><em>Default:</em> <code>None</code>, Vector with zernike amplitudes of a static aberration. Coefficients are in <strong>nm RMS</strong>. If absent not used.</td></tr></tbody></table>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-jitter-jitter_fwhm">1. Jitter (<code>jitter_FWHM</code>)<a href="#1-jitter-jitter_fwhm" class="hash-link" aria-label="Direct link to 1-jitter-jitter_fwhm" title="Direct link to 1-jitter-jitter_fwhm">‚Äã</a></h3>
<div style="text-align:justify"><p>The parameter <code>jitter_FWHM</code> defines a Gaussian kernel (FWHM in <em>mas</em>) that is convolved with the final PSF.
It is used to model an additional tip/tilt jitter ( e.g. vibrations, PSF drifts, ...).</p></div>
<div style="border-left:4px solid #4ea3f1;background:#e8f4ff;padding:10px 14px;margin:12px 0;border-radius:4px"><p>‚úèÔ∏è <strong><i>Implementation note:</i></strong> <br> This Gaussian convolution is applied at the final stage of
TipTop‚Äôs pipeline (in <a href="https://github.com/astro-tiptop/TIPTOP/blob/d5cceb2d215e81004218b67bca10b6ef87dc8b92/tiptop/baseSimulation.py#L530C9-L530C25" target="_blank" rel="noopener noreferrer"><code>tiptop.baseSimulation.finalConvolution()</code></a>).</p></div>
<p>How to define it:</p>
<ul>
<li>Circular jitter</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">telescope</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jitter_FWHM </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30.0</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> mas</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Elliptical jitter:</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">telescope</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jitter_FWHM </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">25.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> FWHM_X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FWHM_Y </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mas</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> angle </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">deg</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Effects of <code>jitter_FWHM</code></strong> :</p>
<div style="text-align:justify"><ul><li><b>Broadens the PSF core</b> (direct effect). </li><li><b>Increases the PSF FWHM</b> as the jitter amplitude grows.</li><li><b>Reduces the Strehl ratio</b>, since energy leaves the core.</li><li><b>Slightly smooths the halo</b></li></ul><p>Because <code>jitter_FWHM</code> corresponds to tip‚Äìtilt‚Äìdominated residuals, it mainly acts on
the lowest spatial frequencies: it widens the core while having minimal effect on the
shape of the outer AO halo.</p></div>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="jitter_FWHMa" src="/astro-tiptop-services/assets/images/jitter_fwhm_0-6dcf87d7c68bb2308b9144bd453ebbce.jpg" width="2122" height="650" class="img_ev3q"></p><p></p>
<div style="border-left:4px solid #2ed373ff;background:#f1ffe8ff;padding:10px 14px;margin:12px 0;border-radius:4px;text-align:justify"><p><strong>Tuning</strong></p><div style="text-align:justify"><p>In practice, this extra parameter is often added first, then its value is refined after introducing <code>extraError*</code> and
<code>zCoefStaticOn</code>, since these parameters also modify the core‚Äìhalo energy balance
(although through different mechanisms).</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax">2. Extra high-order error (<code>extraErrorNm</code>, <code>extraErrorExp</code>, <code>extraErrorMin</code>, <code>extraErrorMax</code>)<a href="#2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax" class="hash-link" aria-label="Direct link to 2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax" title="Direct link to 2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax">‚Äã</a></h3>
<div style="text-align:justify"><p>The <code>extraError*</code> parameters allow you to introduce an additional, user-defined wavefront error
described by a simple spatial-frequency power law. <br>
This term is useful to model high-order aberrations not otherwise represented in <strong>TipTop</strong>, such as
residual manufacturing erros, residual telescope contributions, or any unmodelled generic high-order
static term.</p></div>
<div style="border-left:4px solid #4ea3f1;background:#e8f4ff;padding:10px 14px;margin:12px 0;border-radius:4px;text-align:justify"><p>‚úèÔ∏è <strong><i>Implementation note:</i></strong> <br>
TipTop computes an <strong>additional PSD</strong> from these
parameters inside <a href="https://github.com/astro-tiptop/P3/blob/c074643ffa6ddb4b5b2424749a5f10e7d413b6f7/p3/aoSystem/fourierModel.py#L1328" target="_blank" rel="noopener noreferrer"><code>p3.aoSystem.fourierModel.extraErrorPSD()</code></a>, and this PSD is then
<b>added to the AO PSD</b> in <a href="https://github.com/astro-tiptop/P3/blob/c074643ffa6ddb4b5b2424749a5f10e7d413b6f7/p3/aoSystem/fourierModel.py#L650" target="_blank" rel="noopener noreferrer"><code>p3.aoSystem.fourierModel.powerSpectrumDensity()</code></a>
(after aliasing, noise, temporal and other contributions).<br>
This provides a straightforward way to inject a generic static high-order
aberration PSD into the error budget.</p></div>
<p><strong>Meaning of the parameters</strong></p>
<div style="text-align:justify"><ul> <li><code>extraErrorNm</code> ‚Äì total RMS amplitude (in <em>nm</em>) of the additional error</li>
<li><code>extraErrorExp</code> ‚Äì exponent of the power-law spectrum (default ‚Äì2)</li>
<li><code>extraErrorMin</code> / <code>extraErrorMax</code> ‚Äì optional lower/upper spatial-frequency limits (in <em>m<sup>‚àí1</sup></em>).</li> </ul></div>
<p><strong>Effects of the <code>extraError*</code> parameters</strong></p>
<div style="text-align:justify"><ul>
<li><b>Strehl ratio reduction</b><br>
<!-- -->Increasing <code>extraErrorNm</code> increases the total WFE and transfers energy
from the PSF core into the halo.</li>
<li><b>Encircled-energy modification</b><br>
<!-- -->Higher <code>extraErrorNm</code> values decrease EE at small radii and increase it at larger radii.</li>
<li><b>Halo-shape variation</b><br>
<!-- -->The power-law exponent <code>extraErrorExp</code> controls how energy is distributed across spatial frequencies:<!-- -->
<ul><li>steeper (more negative) slopes ‚Üí more low-frequency power ‚Üí broader halo</li><li>shallower slopes ‚Üí more high-frequency power ‚Üí sharper halo edge</li></ul>
</li>
</ul></div>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="ExtraErrorNm" src="/astro-tiptop-services/assets/images/extra_errora-688b0922a731d893a4e0f6e0e34993c4.jpg" width="2122" height="644" class="img_ev3q"></p><p></p>
<div style="text-align:justify"><p>The exponent <code>extraErrorExp</code> determines how quickly the PSD decreases with frequency.<br>
<!-- -->Changing this exponent modifies how energy is redistributed between intermediate and high spatial frequencies, which directly affects the core‚Äìto‚Äìhalo balance.</p><p><code>extraErrorMin</code> and <code>extraErrorMax</code> further allow you to restrict
the spatial-frequency range over which the additional error is applied.</p></div>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="ExtraErrorM" src="/astro-tiptop-services/assets/images/extra_errorb-af85ca69882f94dd534a665434975e2e.jpg" width="2168" height="638" class="img_ev3q"></p><p></p>
<div style="border-left:4px solid #2ed373ff;background:#f1ffe8ff;padding:10px 14px;margin:12px 0;border-radius:4px;text-align:justify"><p><strong>Tuning</strong></p><div style="text-align:justify"><p>In practice, after adding <code>jitter_FWHM</code>, the
<code>extraError*</code> parameters are typically used to adjust the level and shape of the
halo.</p><p>A larger <code>extraErrorNm</code> decreases the Strehl ratio by injecting
additional high-order wavefront error, thereby raising the halo.<br>
<!-- -->The exponent <code>extraErrorExp</code> then provides finer control over the
halo slope by redistributing energy between intermediate and high spatial
frequencies.</p><p>Because the effects of several parameters can partially overlap, the tuning process is
iterative: modifying <code>extraErrorNm</code> often requires
revisiting <code>extraErrorExp</code>, and these adjustments must remain
consistent with any static aberrations introduced through
<code>zCoefStaticOn</code> or <code>PathStaticOn</code>.</p><p>In the &quot;MUSE PSF-fitting&quot; example shown below (for a science wavelength of 500<i>nm</i>),
the effect of <code>extraErrorNm</code> and <code>extraErrorExp</code>
on the radial and directional profiles can be inspected to determine which combination best reproduces the observed halo amplitude and slope.
The plots illustrate how varying these parameters affect the PSF shape during manual tuning.
For simplicity, only the X-cut of the PSF is shown here for a single star ‚Äî
the objective is purely to visualize the qualitative impact of these parameters.<br>
<i>Note:</i> the example results correspond to simulations using <code>zCoefStaticOn = [0, 0, 100]</code> (focus term added).</p><p align="center"> <img decoding="async" loading="lazy" alt="ExtraErrorNm_Exp" src="/astro-tiptop-services/assets/images/extraErrorNm_Exp-549fbfdb56b2b3a1dccdea6c843ff589.jpg" width="3575" height="1409" class="img_ev3q">  </p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-static-aberrations-pathstaticon-zcoefstaticon">3. Static aberrations (<code>PathStaticOn</code>, <code>zCoefStaticOn</code>)<a href="#3-static-aberrations-pathstaticon-zcoefstaticon" class="hash-link" aria-label="Direct link to 3-static-aberrations-pathstaticon-zcoefstaticon" title="Direct link to 3-static-aberrations-pathstaticon-zcoefstaticon">‚Äã</a></h3>
<div style="text-align:justify"><p>Static aberrations correspond to wavefront errors that are fixed in time and do not evolve
during the simulation.<br>
<!-- -->In <b>TipTop</b>, to introduce such static terms you can define:</p><ul><li>a user-provided OPD map (<code>PathStaticOn</code>)</li><li>a set of Zernike coefficients (<code>zCoefStaticOn</code>)</li></ul></div>
<div style="border-left:4px solid #4ea3f1;background:#e8f4ff;padding:10px 14px;margin:12px 0;border-radius:4px;text-align:justify"><p>‚úèÔ∏è <i><b>Implementation note:</b></i>  <br>
Both contributions are combined into an on-axis OPD map (in <em>nm</em>) inside the
<code>telescope</code> class (attribute <a href="https://github.com/astro-tiptop/P3/blob/c074643ffa6ddb4b5b2424749a5f10e7d413b6f7/p3/aoSystem/telescope.py#L122" target="_blank" rel="noopener noreferrer"><code>tel.opdMap_on</code></a>).
This OPD map is then applied in the pupil plane when computing the final PSFs, on top of the AO residual
wavefront error.</p></div>
<hr>
<p><strong>3.1 Using an OPD map (PathStaticOn)</strong></p>
<div style="text-align:justify"><p><code>PathStaticOn</code> allows you to load a static optical path difference map (in <em>nm</em>)
from a <code>FITS</code> file.<br>
<!-- -->It adds a static aberration (it can be used to add any kind of static aberrations).</p><p>This is the recommended approach when you have a measured or simulated aberration map.<br>
The OPD map is rescaled/rotated to match the telescope pupil resolution and geometry and is then
used as an additional OPD term during PSF computation.</p></div>
<p>One example is the static aberration given by ELT M1 (<a href="https://github.com/astro-tiptop/TIPTOP/blob/main/tiptop/data/ELT_M1_MORFEO_DMs_static_wfe_480px.fits" target="_blank" rel="noopener noreferrer">available here</a>).</p>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="PathStaticOn" src="/astro-tiptop-services/assets/images/PathStaticOn-a10e26109b5bb4428a7e27a51d0ce441.jpg" width="2136" height="784" class="img_ev3q"></p><p></p>
<hr>
<p><strong>3.2 Using Zernike coefficienrs (<code>zCoefStaticOn</code>)</strong></p>
<div style="text-align:justify"><p><code>zCoefStaticOn</code> provides a compact way to introduce a combination of zernike modes that model a static aberration.
The values are given in <i>nm RMS</i> and follow the standard <b>Noll index</b> ordering (Z2 = tilt, Z3 = tilt, Z4 = defocus, Z5‚ÄìZ6 = astigmatism, ‚Ä¶).</p></div>
<div style="border-left:4px solid #4ea3f1;background:#e8f4ff;padding:10px 14px;margin:12px 0;border-radius:4px;text-align:justify"><p>‚úèÔ∏è <i><b>Implementation note:</b></i><br>
<!-- -->Inside <code>telescope</code> class, TipTop:</p><ul><li>builds the corresponding Zernike basis on the pupil,</li><li>orthonormalizes the modes on the actual pupil support,</li><li>normalizes each mode to 1 nm RMS,</li><li>and finally forms <code>opdMap_on</code> by summing the modes weighted by the coefficients in <code>zCoefStaticOn</code>.</li></ul></div>
<p>Examples:</p>
<table><thead><tr><th style="text-align:left">Mode</th><th style="text-align:left"><code>zCoefStaticOn</code></th></tr></thead><tbody><tr><td style="text-align:left">Focus</td><td style="text-align:left">[0, 0, 100]</td></tr><tr><td style="text-align:left">Astigmastism</td><td style="text-align:left">[0, 0, 0, 100]</td></tr><tr><td style="text-align:left">Trefoil</td><td style="text-align:left">[0, 0, 0, 0, 0, 0, 0, 100]</td></tr><tr><td style="text-align:left">Spherical</td><td style="text-align:left">[0, 0, 0, 0, 0, 0, 0, 0, 0, 100]</td></tr></tbody></table>
<p align="center"></p><p><img decoding="async" loading="lazy" alt="Zernike_modes" src="/astro-tiptop-services/assets/images/zernike_poly-8434641d068bd002ca545fd69db57bdc.png" width="3228" height="715" class="img_ev3q"></p><p></p>
<p><strong>Effects of static aberrations</strong></p>
<div style="text-align:justify"><ul><li><b>Strehl ratio degradation</b> ‚Äî depending on the total RMS and the Zernike content.</li><li><b>PSF shape modification</b> ‚Äî Zernike modes introduce directional features (e.g. astigmatism, coma), while arbitrary OPD maps can create more complex patterns.</li><li><b>Energy redistribution</b> ‚Äî static aberrations alter both the PSF core and halo, with characteristic signatures depending on the aberration type.</li></ul></div>
<p><strong>Typical use</strong></p>
<div style="text-align:justify"><p>Use <code>PathStaticOn</code> when you have a known, structured pupil-plane aberration
(e.g. calibration-derived NCPA, optics maps, segmented mirror errors). <br>
Use <code>zCoefStaticOn</code> to explore the impact of specific modes (focus, astigmatism, trefoil, ‚Ä¶)
or to test simple static error scenarios in a controlled way.</p></div>
<div style="border-left:4px solid #2ed373ff;background:#f1ffe8ff;padding:10px 14px;margin:12px 0;border-radius:4px;text-align:justify"><p><strong>Tuning</strong></p><p>In our &quot;MUSE tuning example&quot;, a set of Zernike coefficients was used together with <code>jitter_FWHM</code>
and <code>extraError*</code> to reproduce the observed PSF, matching both core width and halo level.</p><p>The example below illustrates the impact of adding a simple defocus term via
<code>zCoefStaticOn = [0, 0, 100]</code> on the PSF shape (X-cut only, for clarity).</p><p align="center"></p><p><img decoding="async" loading="lazy" alt="zCoefStaticOn" src="/astro-tiptop-services/assets/images/zCoefStaticOn-ee4f24ab3995e315dff1810d4215e2d1.jpg" width="490" height="389" class="img_ev3q"></p><p></p></div>
<p><b>Note on wavelength:</b> the sensitivity of PSF features to these parameters
depends on the simulation wavelength. Users should perform comparisons at the wavelength(s)
most relevant for their science case, as different wavelengths emphasise different spatial
frequency ranges of the PSF.</p>
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-useful-scripts">üìÑ Useful Scripts<a href="#-useful-scripts" class="hash-link" aria-label="Direct link to üìÑ Useful Scripts" title="Direct link to üìÑ Useful Scripts">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-run-n-tiptop-simulations-with-different-parameter-values">üîµ Run <i>N</i> <strong>TipTop</strong> Simulations with Different Parameter Values<a href="#-run-n-tiptop-simulations-with-different-parameter-values" class="hash-link" aria-label="Direct link to -run-n-tiptop-simulations-with-different-parameter-values" title="Direct link to -run-n-tiptop-simulations-with-different-parameter-values">‚Äã</a></h3>
<div style="text-align:justify"><p>Here, we provide an example script to run <i>N</i> <strong>TipTop</strong> simulations with different values of two parameters:
<code>ZenithAngle</code> and <code>Seeing</code>. The script can easily be adapted to sweep over a single parameter or more than two.</p></div>
<p><strong>Download the script:</strong>
<a href="/astro-tiptop-services/downloads/TIPTOP_RUN_N_SIM.py" download="TIPTOP_RUN_N_SIM.py"><span style="font-size:1.5em">üì•</span></a>.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong> Running <i>N</i> <strong>TipTop</strong> simulations: <code>TIPTOP_RUN_N_SIM.py</code> </strong></summary><div><div class="collapsibleContent_i85q"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Created on Thu Jul 10 10:00:34 2025</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Run N TIPTOP simulations by sweeping over different parameter values.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">@author: astro-tiptop-services</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Import necessary libraries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tiptop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tiptop </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> overallSimulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> configparser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> itertools </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> product</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === File Paths ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#üí° Adapt these paths to your environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inputDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;../MICADO/&quot;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Folder containing the .ini parameter file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inTag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MICADO_SCAO&quot;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Name of the input parameter file (without extension)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outputDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./&quot;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Folder where the output FITS files will be saved </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tempDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> inputDir        </span><span class="token comment" style="color:#999988;font-style:italic"># Temporary folder for modified .ini files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tempName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;file_temp&#x27;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Name of the temporary file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Construct the full path to the input and temporary config files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inputFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">inTag</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.ini&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tempFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tempDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">tempName</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.ini&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Base name for output files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outTagBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MICADO&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Define parameters to sweep ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># üí° Format: (section_name, key_name, list_of_values : min, max, number of values)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">param_sweep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;atmosphere&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Seeing&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linspace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;telescope&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ZenithAngle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linspace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Add more parameters as needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Read base configuration file ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> configparser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConfigParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optionxform </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Keep the original case of parameter keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Build and run combinations ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Extract parameter names and values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">param_names </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">sec</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _ </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> param_sweep</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">param_values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">vals </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vals </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> param_sweep</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Generate all combinations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> combo </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> product</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">param_values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Update .ini with current parameter values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">section</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param_sweep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> combo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      parser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">section</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Write updated config to temporary .ini file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tempFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;w&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> configfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          parser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">configfile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Build output file tag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tag_parts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">split</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation operator" style="color:#393A34">-</span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">val</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">param_names</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> combo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">outTagBase</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">_</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;_&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">join</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">tag_parts</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;üîÑ Running simulation with: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">dict</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation builtin">zip</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">param_names</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">,</span><span class="token string-interpolation interpolation"> combo</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Run TipTop simulation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      overallSimulation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          path2param</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tempDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          parametersFile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tempName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          outputDir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">outputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          outputFile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          addSrAndFwhm</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-rename-output-fits-files-and-keep-backups">üîµ Rename Output FITS Files and Keep Backups<a href="#-rename-output-fits-files-and-keep-backups" class="hash-link" aria-label="Direct link to üîµ Rename Output FITS Files and Keep Backups" title="Direct link to üîµ Rename Output FITS Files and Keep Backups">‚Äã</a></h3>
<div style="text-align:justify"><p>This script renames PSF FITS files (e.g., those generated by the previous script)
to facilitate their use in other routines, while creating backups of the originals.
For example, it renames FITS files in your folder starting with the tag MICADO
to simple, easily readable names like <code>MICADO_PSF1.fits</code>, <code>MICADO_PSF2.fits</code>, and so on.</p></div>
<p><strong>Download the script:</strong>
<a href="/astro-tiptop-services/downloads/TIPTOP_rename_psf_files.py" download="TIPTOP_rename_psf_files.py"><span style="font-size:1.5em">üì•</span></a></p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong> Rename output PSF FITS files: <code>TIPTOP_rename_psf_files.py</code> </strong></summary><div><div class="collapsibleContent_i85q"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Created on Thu Jul 10 14:15:45 2025</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Rename output PSF FITS files sequentially for easier access and keep original copies.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">@author: astro-tiptop-services</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Import necessary libraries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> shutil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Configuration ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#üí° Adapt these paths to your environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inputDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./&quot;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Directory containing the generated FITS files </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backupDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Original_PSFs&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Directory to store backups of original files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outputDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Renamed_PSFs&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Directory where renamed files will be moved (must exist)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TagBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MICADO&quot;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Base name used in the output FITS filenames</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Create output and backup directories if they do not exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backupDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Gather and sort relevant FITS files ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output_files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">sorted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">f </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> f </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">listdir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TagBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;.fits&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check if any matching files are found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> output_files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;[INFO] No matching FITS files found for renaming.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[INFO] Found </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">output_files</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> FITS files to rename.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Copy and Rename files sequentially as TagBase_PSF1.fits, MICADO_PSF2.fits, etc. ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fname </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">output_files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dst </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">TagBase</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">_PSF</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.fits&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">backupDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Copy the original file to the backup folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      shutil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">copy2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> backup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Rename (and move) the file to the new destination</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[INFO] Renamed: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fname</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> ‚Üí </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">TagBase</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">_PSF</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.fits (Backup saved)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> PermissionError</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[‚ö†Ô∏è  WARNING] File in use and cannot be renamed: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fname</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[‚ùå ERROR] Failed to rename </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fname</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> ‚Üí </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;\n‚úÖ Process complete. </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">output_files</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> files renamed and backed up.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-sum-rotated-psf">üîµ Sum rotated PSF<a href="#-sum-rotated-psf" class="hash-link" aria-label="Direct link to üîµ Sum rotated PSF" title="Direct link to üîµ Sum rotated PSF">‚Äã</a></h3>
<div style="text-align:justify"><p>This script combines multiple PSFs into a single image by rotating each individual PSF
by a specified field rotation angle before summation. <br>
Used together with the two previous scripts, this process can be
especially useful, for example, when simulating long integrations to reproduce the impact of pupil rotation and field rotation on the final image.</p><p>‚úèÔ∏è <strong>Note</strong>: You need to manually define the list of field rotation angles in the script ‚Äî one angle per PSF FITS file.<br>
Feel free to adapt this script to suit TipTop simulations involving multiple science sources.
The example provided here illustrates its use with the input parameter file
<a href="/astro-tiptop-services/docs/orion/aoinstruments#micado">MICADO.ini</a>. <br></p></div>
<p><strong>Download the script:</strong>
<a href="/astro-tiptop-services/downloads/TIPTOP_rotated_PSF_sum.py" download="TIPTOP_rotated_PSF_sum.py"><span style="font-size:1.5em">üì•</span></a></p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong> Sum rotated AO PSFs: <code>TIPTOP_rotated_PSF_sum.py</code> </strong></summary><div><div class="collapsibleContent_i85q"><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Created on Thu Jul 10 15:01:55 2025</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Sum rotated PSFs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">Each PSF is rotated by a specified angle before summation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">@author: astro-tiptop-services</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Import necessary libraries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> scipy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ndimage </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rotate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> astropy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> fits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Configuration ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inputDir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Renamed_PSFs&quot;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># Folder where the PSF FITS files are stored</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TagBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MICADO&quot;</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># Base tag for the PSF files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outputFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PSF_sum.fits&quot;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Filename for the combined output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Rotation angles (degrees) applied to each PSF before summation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rotation_angles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># üí° To be defined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rotation_angles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Should match the number of PSF files available</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Load and combine rotated PSFs ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">first_filename </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">TagBase</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">_PSF1.fits&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> FileNotFoundError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Base file </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">first_filename</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> is missing. Check input directory.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">first_img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getdata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accumulated </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros_like</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dtype</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Accumulator for summing rotated PSFs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">valid_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Count how many files were found and used</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Loop over all images and angles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filename </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inputDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">TagBase</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">_PSF</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.fits&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Check if file exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[WARNING] Missing file: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">filename</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[INFO] Loading file: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">filename</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getdata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Rotate the image by the corresponding angle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rotated </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rotate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> angle</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rotation_angles</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reshape</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Accumulate the rotated image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accumulated </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> rotated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valid_count </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#%% =============================================================================</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># === Normalize and save result ===</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> valid_count </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accumulated </span><span class="token operator" style="color:#393A34">/=</span><span class="token plain"> valid_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Save PSF sum to a FITS file, overwrite if exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">writeto</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outputFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> accumulated</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> overwrite</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;[INFO] Combined PSF saved to: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">outputFile</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;[ERROR] No valid PSF files found. No output generated.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/astro-tiptop-services/docs/orion/interactivetools"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Interactive tools ‚Äì Generate Input Files &amp; Convert Parameters</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/astro-tiptop-services/docs/orion/parameterfiles"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Parameter files explained</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-tutorials" class="table-of-contents__link toc-highlight">üìù Tutorials</a><ul><li><a href="#-understanding-additional-error-terms-in-tiptop-jitter-extra-error-and-static-aberrations" class="table-of-contents__link toc-highlight">üîµ Understanding Additional Error Terms in TipTop (Jitter, Extra Error and Static aberrations)</a></li><li><a href="#overview-of-the-main-parameters" class="table-of-contents__link toc-highlight">Overview of the main parameters</a></li><li><a href="#1-jitter-jitter_fwhm" class="table-of-contents__link toc-highlight">1. Jitter (<code>jitter_FWHM</code>)</a></li><li><a href="#2-extra-high-order-error-extraerrornm-extraerrorexp-extraerrormin-extraerrormax" class="table-of-contents__link toc-highlight">2. Extra high-order error (<code>extraErrorNm</code>, <code>extraErrorExp</code>, <code>extraErrorMin</code>, <code>extraErrorMax</code>)</a></li><li><a href="#3-static-aberrations-pathstaticon-zcoefstaticon" class="table-of-contents__link toc-highlight">3. Static aberrations (<code>PathStaticOn</code>, <code>zCoefStaticOn</code>)</a></li></ul></li><li><a href="#-useful-scripts" class="table-of-contents__link toc-highlight">üìÑ Useful Scripts</a><ul><li><a href="#-run-n-tiptop-simulations-with-different-parameter-values" class="table-of-contents__link toc-highlight">üîµ Run <i>N</i> <strong>TipTop</strong> Simulations with Different Parameter Values</a></li><li><a href="#-rename-output-fits-files-and-keep-backups" class="table-of-contents__link toc-highlight">üîµ Rename Output FITS Files and Keep Backups</a></li><li><a href="#-sum-rotated-psf" class="table-of-contents__link toc-highlight">üîµ Sum rotated PSF</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Tutorials</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/astro-tiptop-services/docs/intro">TipTop Installation Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/astro-tiptop-services/docs/quickstart">TipTop Quickstart Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/astro-tiptop-services/terms">Terms &amp; Conditions</a></li><li class="footer__item"><a class="footer__link-item" href="/astro-tiptop-services/resources/contact">Contact us</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/astro-tiptop/TIPTOP" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://pypi.org/project/astro-tiptop/" target="_blank" rel="noopener noreferrer" class="footer__link-item">PyPi<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 Astro-TipTop-Services. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>